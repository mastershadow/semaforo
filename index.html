<!DOCTYPE html><html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Semafori Live – Orezzo &amp; Gazzaniga</title>
  <!-- TailwindCSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <style>
    body {
      /* layout */
      @apply bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white font-inter min-h-screen flex flex-col items-center pt-8 gap-6 overflow-hidden;
    }
    /* lampadine base */
    .lamp { @apply h-20 w-20 sm:h-24 sm:w-24 rounded-full bg-slate-700 transition-colors duration-300 shadow-inner; }
    .on   { @apply shadow-2xl shadow-current; }/* Colorazioni ON */
#red.on,   #redG.on   { background: radial-gradient(circle at center, #ff4d4d, #7f1d1d); }
#orange.on,#orangeG.on{ background: radial-gradient(circle at center, #f59e0b, #78350f); }
#green.on, #greenG.on { background: radial-gradient(circle at center, #22c55e, #065f46); }

  </style>
</head>
<body>
  <header class="text-center animate-fade-in-down">
    <h1 class="text-3xl sm:text-4xl font-semibold tracking-tight">Semafori in <span class="text-emerald-400">Val Seriana</span></h1>
    <p class="text-sm text-slate-400 mt-2">Sincronizzati con <a href="https://time.is/Europe/Rome" target="_blank" class="underline decoration-dotted">time.is</a></p>
  </header>  <!-- Slider di selezione -->  <div class="flex flex-col items-center gap-2 animate-fade-in-up">
    <input id="semSlider" type="range" min="0" max="1" step="1" value="0" class="w-48 accent-emerald-500 cursor-pointer">
    <div class="flex justify-between w-48 text-xs">
      <span>Orezzo</span>
      <span>Gazzaniga</span>
    </div>
  </div>  <!-- Semaforo Orezzo -->  <section id="trafficO" class="flex flex-col items-center gap-6 bg-slate-800/50 backdrop-blur-lg px-10 py-8 rounded-3xl shadow-xl ring-1 ring-white/10 animate-fade-in-up">
    <p class="mb-2 font-semibold tracking-wide">Orezzo</p>
    <div id="red"    class="lamp"></div>
    <div id="orange" class="lamp"></div>
    <div id="green"  class="lamp"></div>
  </section>  <!-- Semaforo Gazzaniga -->  <section id="trafficG" class="hidden flex flex-col items-center gap-6 bg-slate-800/50 backdrop-blur-lg px-10 py-8 rounded-3xl shadow-xl ring-1 ring-white/10 animate-fade-in-up">
    <p class="mb-2 font-semibold tracking-wide">Gazzaniga</p>
    <div id="redG"    class="lamp"></div>
    <div id="orangeG" class="lamp"></div>
    <div id="greenG"  class="lamp"></div>
  </section>  <!-- Orologio live -->  <div id="clock" class="font-mono text-4xl tracking-widest animate-fade-in-up"></div>  <!-- Footer -->  <footer class="mt-auto pb-6 text-xs opacity-60">
    sviluppato da <a href="https://linktr.ee/micmer" target="_blank" class="underline">micmer</a>
  </footer>  <script>
    // ---------- CONFIGURAZIONE ----------
    const GREEN_DURATION  = 31;   // secondi di verde
    const ORANGE_DURATION = 5;    // secondi di arancione
    const CYCLES_BETWEEN  = 118;  // cicli tra 2 verdi Orezzo

    // Riferimenti di fase (Europe/Rome)
    const O_REF1 = new Date('2025-06-04T19:24:10+02:00');
    const O_REF2 = new Date('2025-06-05T11:28:42+02:00');
    const G_REF  = new Date('2025-06-03T12:57:15+02:00');

    // Calcoli lunghezza ciclo e rosso
    const totalCycle   = (O_REF2 - O_REF1) / 1000 / CYCLES_BETWEEN;   // ≈ 490.45 s
    const RED_DURATION = totalCycle - (GREEN_DURATION + ORANGE_DURATION); // ≈ 454.44 s

    // Mapping lampade DOM
    const lampsO = {
      red:    document.getElementById('red'),
      orange: document.getElementById('orange'),
      green:  document.getElementById('green')
    };
    const lampsG = {
      red:    document.getElementById('redG'),
      orange: document.getElementById('orangeG'),
      green:  document.getElementById('greenG')
    };

    const trafficO = document.getElementById('trafficO');
    const trafficG = document.getElementById('trafficG');
    const slider   = document.getElementById('semSlider');
    const clockEl  = document.getElementById('clock');

    // Sincronizzazione con worldtimeapi (stessa fonte di time.is)
    let offsetMs = 0;
    fetch('https://worldtimeapi.org/api/timezone/Europe/Rome')
      .then(r => r.json())
      .then(data => { offsetMs = new Date(data.datetime).getTime() - Date.now(); })
      .catch(() => console.warn('Impossibile sincronizzare, uso orologio locale.'));

    function now() { return Date.now() + offsetMs; }

    function renderSemaforo(lamps, cyclePos) {
      let phase;
      if (cyclePos < GREEN_DURATION) phase = 'green';
      else if (cyclePos < GREEN_DURATION + ORANGE_DURATION) phase = 'orange';
      else phase = 'red';

      for (const [key, el] of Object.entries(lamps)) {
        if (key === phase) el.classList.add('on');
        else el.classList.remove('on');
      }
    }

    function update() {
      // Orezzo
      const elapsedO  = (now() - O_REF1.getTime()) / 1000;
      const cyclePosO = ((elapsedO % totalCycle) + totalCycle) % totalCycle;
      renderSemaforo(lampsO, cyclePosO);

      // Gazzaniga
      const elapsedG  = (now() - G_REF.getTime()) / 1000;
      const cyclePosG = ((elapsedG % totalCycle) + totalCycle) % totalCycle;
      renderSemaforo(lampsG, cyclePosG);

      // Orologio live
      const d = new Date(now());
      clockEl.textContent = d.toLocaleTimeString('it-IT', { hour12: false });
    }

    // Slider per cambio vista
    slider.addEventListener('input', () => {
      if (slider.value === '0') {
        trafficO.classList.remove('hidden');
        trafficG.classList.add('hidden');
      } else {
        trafficG.classList.remove('hidden');
        trafficO.classList.add('hidden');
      }
    });

    // Avvio loop
    update();
    setInterval(update, 100);
  </script></body>
</html>