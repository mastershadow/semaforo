<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orezzo Semaforo</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: #f0f2f5;
            color: #333;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        .container {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
            padding: 30px 40px;
            text-align: center;
            max-width: 500px;
            width: 100%;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 25px;
            font-size: 2.2em;
        }

        .current-time, .sync-info {
            font-size: 1.1em;
            margin-bottom: 15px;
            color: #555;
        }

        .sync-info a {
            color: #007bff;
            text-decoration: none;
            font-weight: bold;
        }

        .sync-info a:hover {
            text-decoration: underline;
        }

        .semaforo {
            background-color: #3a3a3a;
            border-radius: 20px;
            padding: 20px;
            display: inline-block;
            margin: 25px auto;
            box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.4);
        }

        .light {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: #555;
            margin: 15px;
            border: 5px solid #222;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.6);
            opacity: 0.3;
            transition: opacity 0.3s ease-in-out, background-color 0.3s ease-in-out;
        }

        .light.red {
            background-color: #e74c3c;
            opacity: 1;
            box-shadow: 0 0 25px rgba(231, 76, 60, 0.8), inset 0 0 10px rgba(255, 255, 255, 0.3);
        }

        .light.orange {
            background-color: #f39c12;
            opacity: 1;
            box-shadow: 0 0 25px rgba(243, 156, 18, 0.8), inset 0 0 10px rgba(255, 255, 255, 0.3);
        }

        .light.green {
            background-color: #2ecc71;
            opacity: 1;
            box-shadow: 0 0 25px rgba(46, 204, 113, 0.8), inset 0 0 10px rgba(255, 255, 255, 0.3);
        }

        .status-message {
            font-size: 1.4em;
            font-weight: bold;
            margin-top: 20px;
            color: #34495e;
        }

        .countdown {
            font-size: 1.6em;
            font-weight: bold;
            color: #2c3e50;
            margin-top: 10px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .footer {
            margin-top: 30px;
            font-size: 0.9em;
            color: #777;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Orezzo Semaforo Status</h1>
        <div class="current-time" id="currentTime"></div>
        <div class="sync-info">
            For best accuracy, please synchronize your system time with <a href="https://time.is/" target="_blank">time.is</a>
        </div>

        <div class="semaforo">
            <div class="light" id="redLight"></div>
            <div class="light" id="orangeLight"></div>
            <div class="light" id="greenLight"></div>
        </div>

        <div class="status-message" id="semaforoStatus"></div>
        <div class="countdown" id="countdown"></div>
    </div>

    <div class="footer">
        <p>Green time: 31s | Orange time: 5s | Red time: 7m 35s</p>
        <p>Last observed green (Orezzo): June 5th, 11:28:42 (CEST)</p>
    </div>

    <script>
        // Define durations in seconds
        const GREEN_DURATION = 31;
        const ORANGE_DURATION = 5;
        const RED_DURATION = 455; // 7 minutes 35 seconds = 420 + 35 = 455 seconds
        const CYCLE_DURATION = GREEN_DURATION + ORANGE_DURATION + RED_DURATION; // 31 + 5 + 455 = 491 seconds

        // Reference point: Last observed green light start for Orezzo
        // June 5th, 11:28:42 (CEST)
        // Note: Months are 0-indexed in JavaScript (June is 5)
        const REFERENCE_DATE_STR = '2025-06-05T11:28:42';
        const REFERENCE_GREEN_START = new Date(REFERENCE_DATE_STR);
        // Adjust for CEST offset (UTC+2 in summer) if the user's system is not already in CEST.
        // For simplicity and assuming local time, we'll use local time.
        // If the user's browser is in a different timezone, this might need more robust handling.
        // For accurate calculation, we should convert everything to UTC and then display in local.
        // For this standalone file, we'll assume the client's clock is set correctly for CEST.
        // Let's ensure the reference date is treated in the local timezone for consistency with `new Date()`
        // For more robust timezone handling, libraries like moment-timezone or luxon are recommended.
        // For now, we'll manually set the time components.
        REFERENCE_GREEN_START.setFullYear(2025, 5, 5); // Year, Month (0-11), Day
        REFERENCE_GREEN_START.setHours(11, 28, 42, 0); // Hours, Minutes, Seconds, Milliseconds


        const redLight = document.getElementById('redLight');
        const orangeLight = document.getElementById('orangeLight');
        const greenLight = document.getElementById('greenLight');
        const semaforoStatus = document.getElementById('semaforoStatus');
        const countdownDisplay = document.getElementById('countdown');
        const currentTimeDisplay = document.getElementById('currentTime');

        function updateSemaforo() {
            const now = new Date();
            currentTimeDisplay.textContent = `Current time: ${now.toLocaleDateString()} ${now.toLocaleTimeString()}`;

            const timeSinceReference = (now.getTime() - REFERENCE_GREEN_START.getTime()) / 1000; // in seconds

            // Handle cases where the current time is before the reference time (e.g., if user changes clock)
            if (timeSinceReference < 0) {
                // If before reference, assume it's red until the reference green time
                setLights('red');
                semaforoStatus.textContent = 'Waiting for cycle to start...';
                const timeToStart = Math.abs(timeSinceReference);
                countdownDisplay.textContent = `Starts in: ${formatTime(timeToStart)}`;
                return;
            }

            const elapsedInCycle = timeSinceReference % CYCLE_DURATION;

            let currentPhase = '';
            let timeInCurrentPhase = 0;
            let timeUntilNextPhase = 0;
            let nextPhase = '';

            if (elapsedInCycle < GREEN_DURATION) {
                currentPhase = 'green';
                timeInCurrentPhase = elapsedInCycle;
                timeUntilNextPhase = GREEN_DURATION - timeInCurrentPhase;
                nextPhase = 'orange';
            } else if (elapsedInCycle < GREEN_DURATION + ORANGE_DURATION) {
                currentPhase = 'orange';
                timeInCurrentPhase = elapsedInCycle - GREEN_DURATION;
                timeUntilNextPhase = (GREEN_DURATION + ORANGE_DURATION) - elapsedInCycle;
                nextPhase = 'red';
            } else {
                currentPhase = 'red';
                timeInCurrentPhase = elapsedInCycle - (GREEN_DURATION + ORANGE_DURATION);
                timeUntilNextPhase = CYCLE_DURATION - elapsedInCycle;
                nextPhase = 'green';
            }

            setLights(currentPhase);

            semaforoStatus.textContent = `Semaforo is ${currentPhase.toUpperCase()}`;
            countdownDisplay.textContent = `Next change to ${nextPhase.toUpperCase()} in: ${formatTime(timeUntilNextPhase)}`;
        }

        function setLights(color) {
            redLight.classList.remove('red');
            orangeLight.classList.remove('orange');
            greenLight.classList.remove('green');

            if (color === 'red') {
                redLight.classList.add('red');
            } else if (color === 'orange') {
                orangeLight.classList.add('orange');
            } else if (color === 'green') {
                greenLight.classList.add('green');
            }
        }

        function formatTime(totalSeconds) {
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = Math.floor(totalSeconds % 60);
            return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Initial update
        updateSemaforo();

        // Update every second
        setInterval(updateSemaforo, 1000);
    </script>
</body>
</html>
