<!DOCTYPE html><html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Semaforo di Orezzo – Live Sync</title>
  <!-- TailwindCSS CDN (v4) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Dark mode friendly & modern font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      @apply bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white font-inter min-h-screen flex flex-col items-center justify-center gap-8 overflow-hidden;
    }
    .lamp {
      @apply h-20 w-20 rounded-full bg-slate-700 transition-colors duration-300 shadow-inner;
    }
    .on {
      @apply shadow-2xl shadow-current;
    }
    #red.on    { background: radial-gradient(circle at center, #ff4d4d, #7f1d1d); }
    #orange.on { background: radial-gradient(circle at center, #f59e0b, #78350f); }
    #green.on  { background: radial-gradient(circle at center, #22c55e, #065f46); }
  </style>
</head>
<body>
  <header class="text-center animate-fade-in-down">
    <h1 class="text-3xl sm:text-4xl font-semibold tracking-tight">Semaforo di <span class="text-emerald-400">Orezzo</span></h1>
    <p class="text-sm text-slate-400 mt-2">Sincronizzato con <a href="https://time.is/Europe/Rome" target="_blank" class="underline decoration-dotted">time.is</a></p>
  </header>  <!-- Traffic light -->  <section id="traffic" class="flex flex-col items-center gap-6 bg-slate-800/50 backdrop-blur-lg px-10 py-8 rounded-3xl shadow-xl ring-1 ring-white/10 animate-fade-in-up">
    <div id="red"    class="lamp"></div>
    <div id="orange" class="lamp"></div>
    <div id="green"  class="lamp"></div>
  </section>  <!-- Live clock -->  <div id="clock" class="font-mono text-4xl tracking-widest animate-fade-in-up"></div>  <script>
    // ------------- CONFIGURATION -------------------
    const GREEN_DURATION   = 31;     // seconds
    const ORANGE_DURATION  = 5;      // seconds (fixed)
    const CYCLES_BETWEEN   = 118;    // cycles between reference greens

    // Reference observations (Europe/Rome timezone)
    const REF1 = new Date('2025-06-04T19:24:10+02:00');
    const REF2 = new Date('2025-06-05T11:28:42+02:00');

    // Derived RED duration and cycle length (using high‑precision floating‑point)
    const totalCycle = (REF2 - REF1) / 1000 / CYCLES_BETWEEN;      // ≈ 490.45 s
    const RED_DURATION = totalCycle - (GREEN_DURATION + ORANGE_DURATION); // ≈ 454.44 s

    // Elements
    const lamps = {
      red:    document.getElementById('red'),
      orange: document.getElementById('orange'),
      green:  document.getElementById('green')
    };
    const clockEl = document.getElementById('clock');

    // Accurate time offset versus server (time.is compatible via worldtimeapi.org)
    let offsetMs = 0;
    fetch('https://worldtimeapi.org/api/timezone/Europe/Rome')
      .then(r => r.json()).then(data => {
        const serverTime = new Date(data.datetime).getTime();
        offsetMs = serverTime - Date.now();
      })
      .catch(() => console.warn('Fallback to local system clock – accuracy may vary'));

    function now() { return Date.now() + offsetMs; }

    function update() {
      const elapsed = (now() - REF1.getTime()) / 1000; // seconds since first reference
      const cyclePos = ((elapsed % totalCycle) + totalCycle) % totalCycle; // 0…cycle

      // Determine current phase
      let phase;
      if (cyclePos < GREEN_DURATION) {
        phase = 'green';
      } else if (cyclePos < GREEN_DURATION + ORANGE_DURATION) {
        phase = 'orange';
      } else {
        phase = 'red';
      }

      // Apply visual state
      for (const [key, el] of Object.entries(lamps)) {
        if (key === phase) {
          el.classList.add('on');
        } else {
          el.classList.remove('on');
        }
      }

      // Render digital clock (hh:mm:ss)
      const d = new Date(now());
      clockEl.textContent = d.toLocaleTimeString('it-IT', { hour12:false });
    }

    // First paint immediately; then refresh ~10×/s for smoothness
    update();
    setInterval(update, 100);
  </script></body>
</html>